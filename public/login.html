<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion - M√©diath√®que</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .auth-tab.active {
            background: #3b82f6;
            color: white;
        }
        .form-input:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md">
        <!-- Logo et titre -->
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-500 text-white rounded-full mb-4">
                <i class="fas fa-book text-2xl"></i>
            </div>
            <h1 class="text-3xl font-bold text-gray-800">M√©diath√®que UEL 315</h1>
            <p class="text-gray-600 mt-2">Projet Bases de Donn√©es - Groupe F</p>
        </div>
        
        <!-- Carte d'authentification -->
        <div class="bg-white rounded-xl shadow-lg p-8">
            <!-- Onglets -->
            <div class="flex mb-6 bg-gray-100 p-1 rounded-lg">
                <button id="tab-login" class="flex-1 py-2 px-4 rounded-md font-medium transition-colors auth-tab active">
                    Connexion
                </button>
                <button id="tab-register" class="flex-1 py-2 px-4 rounded-md font-medium transition-colors auth-tab">
                    Inscription
                </button>
            </div>
            
            <!-- Formulaire Connexion -->
            <div id="form-login" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        <i class="fas fa-envelope mr-2"></i>Email
                    </label>
                    <input type="email" id="login-email" 
                           class="w-full px-4 py-3 border rounded-lg form-input focus:outline-none focus:border-blue-500"
                           placeholder="votre@email.fr"
                           value="admin@mediatheque.fr">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        <i class="fas fa-lock mr-2"></i>Mot de passe
                    </label>
                    <input type="password" id="login-password" 
                           class="w-full px-4 py-3 border rounded-lg form-input focus:outline-none focus:border-blue-500"
                           placeholder="Votre mot de passe"
                           value="admin123">
                </div>
                
                <button onclick="login()" class="w-full bg-blue-500 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-600 transition-colors">
                    <i class="fas fa-sign-in-alt mr-2"></i>Se connecter
                </button>
                
                <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <p class="text-sm text-yellow-800">
                        <i class="fas fa-lightbulb mr-2"></i>
                        <strong>Comptes de test :</strong><br>
                        üëë Admin: admin@mediatheque.fr / admin123<br>
                        üë§ User: user@test.fr / user123
                    </p>
                </div>
                
                <div class="text-center mt-4">
                    <a href="/" class="text-blue-500 hover:text-blue-700 text-sm">
                        <i class="fas fa-arrow-left mr-1"></i>Retour √† l'accueil
                    </a>
                </div>
            </div>
            
            <!-- Formulaire Inscription -->
            <div id="form-register" class="space-y-4 hidden">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        <i class="fas fa-user mr-2"></i>Nom complet
                    </label>
                    <input type="text" id="register-nom" 
                           class="w-full px-4 py-3 border rounded-lg form-input focus:outline-none focus:border-blue-500"
                           placeholder="Votre nom et pr√©nom">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        <i class="fas fa-envelope mr-2"></i>Email
                    </label>
                    <input type="email" id="register-email" 
                           class="w-full px-4 py-3 border rounded-lg form-input focus:outline-none focus:border-blue-500"
                           placeholder="votre@email.fr">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        <i class="fas fa-lock mr-2"></i>Mot de passe
                    </label>
                    <input type="password" id="register-password" 
                           class="w-full px-4 py-3 border rounded-lg form-input focus:outline-none focus:border-blue-500"
                           placeholder="Minimum 3 caract√®res">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        <i class="fas fa-lock mr-2"></i>Confirmer le mot de passe
                    </label>
                    <input type="password" id="register-confirm" 
                           class="w-full px-4 py-3 border rounded-lg form-input focus:outline-none focus:border-blue-500"
                           placeholder="Ressaisissez votre mot de passe">
                </div>
                
                <button onclick="register()" class="w-full bg-green-500 text-white py-3 px-4 rounded-lg font-medium hover:bg-green-600 transition-colors">
                    <i class="fas fa-user-plus mr-2"></i>Cr√©er mon compte
                </button>
            </div>
            
            <!-- Notification -->
            <div id="notification" class="mt-4 hidden p-3 rounded-lg"></div>
        </div>
        
        <!-- Lien admin -->
        <div class="text-center mt-6">
            <a href="/admin" class="text-gray-500 hover:text-gray-700 text-sm">
                <i class="fas fa-cog mr-1"></i>Acc√®s administrateur
            </a>
        </div>
    </div>
    
    <script>
        // Gestion des onglets
        document.getElementById('tab-login').addEventListener('click', () => {
            switchTab('login');
        });
        
        document.getElementById('tab-register').addEventListener('click', () => {
            switchTab('register');
        });
        
        function switchTab(tab) {
            const loginTab = document.getElementById('tab-login');
            const registerTab = document.getElementById('tab-register');
            const loginForm = document.getElementById('form-login');
            const registerForm = document.getElementById('form-register');
            
            if (tab === 'login') {
                loginTab.classList.add('active');
                registerTab.classList.remove('active');
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
            } else {
                registerTab.classList.add('active');
                loginTab.classList.remove('active');
                registerForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
            }
        }
        
        // Connexion
        async function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showNotification('Veuillez remplir tous les champs', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Connexion r√©ussie ! Redirection...', 'success');
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 1500);
                } else {
                    showNotification(data.error, 'error');
                }
            } catch (error) {
                showNotification('Erreur r√©seau', 'error');
            }
        }
        
        // Inscription
        async function register() {
            const nom = document.getElementById('register-nom').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirm = document.getElementById('register-confirm').value;
            
            if (!nom || !email || !password || !confirm) {
                showNotification('Veuillez remplir tous les champs', 'error');
                return;
            }
            
            if (password !== confirm) {
                showNotification('Les mots de passe ne correspondent pas', 'error');
                return;
            }
            
            if (password.length < 3) {
                showNotification('Le mot de passe doit faire au moins 3 caract√®res', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ nom, email, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Compte cr√©√© avec succ√®s ! Vous pouvez maintenant vous connecter.', 'success');
                    switchTab('login');
                    // Pr√©-remplir l'email
                    document.getElementById('login-email').value = email;
                } else {
                    showNotification(data.error, 'error');
                }
            } catch (error) {
                showNotification('Erreur r√©seau', 'error');
            }
        }
        
        // Notification
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `mt-4 p-3 rounded-lg ${
                type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
            }`;
            notification.classList.remove('hidden');
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 5000);
        }
        
        // V√©rifier si d√©j√† connect√©
        async function checkAuth() {
            try {
                const response = await fetch('/api/auth/me');
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Vous √™tes d√©j√† connect√©. Redirection...', 'info');
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 1000);
                }
            } catch (error) {
                // Non connect√©, c'est normal
            }
        }
        
        // V√©rifier au chargement
        checkAuth();
        
        // Entr√©e pour soumettre le formulaire
        document.getElementById('login-password').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                login();
            }
        });
    </script>
</body>
</html>